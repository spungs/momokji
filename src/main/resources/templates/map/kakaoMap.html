<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>카카오 지도 api</title>
    <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=56890df0b42db89c1ce2298848552ff9&libraries=services,clusterer,drawing"></script>

</head>
<body>
    <div id="map" style="width:500px;height:400px;"></div>
</body>
<script>
    // 사용자의 position을 가져오고 비동기방식으로 서버에 전달
    window.onload = function() {
        // 지리적 위치가 지원되는지 확인
        if (navigator.geolocation) {
            // 지원되는 경우 getCurrentPosition() 메서드를 실행, 메서드가 실행되면 매개변수(getMap)에 지정된 함수 실행.
            navigator.geolocation.getCurrentPosition(getMap);
        }
        // 지원되지 않는 경우 사용자에게 메시지 표시
        else {
            // 모바일에선 어떻게 해줄지 고민해봐야함(모달?)
            alert("위치정보를 허용해주세요!");
        }
    }

    function getMap(position) {
        let latitude = position.coords.latitude; // 위도
        let longitude = position.coords.longitude; // 경도

        var container = document.getElementById('map'); //지도를 담을 영역의 DOM 레퍼런스
        var options = { //지도를 생성할 때 필요한 기본 옵션
            center: new kakao.maps.LatLng(latitude, longitude), //지도의 중심좌표.
            level: 3 //지도의 레벨(확대, 축소 정도)
        };

        var map = new kakao.maps.Map(container, options); //지도 생성 및 객체 리턴

        // 마커 클러스터러를 생성합니다
        var clusterer = new kakao.maps.MarkerClusterer({
            map: map, // 마커들을 클러스터로 관리하고 표시할 지도 객체
            averageCenter: true, // 클러스터에 포함된 마커들의 평균 위치를 클러스터 마커 위치로 설정
            minLevel: 10 // 클러스터 할 최소 지도 레벨
        });

        var marker = new kakao.maps.Marker({
            position: new kakao.maps.LatLng(latitude, longitude)
        });

        clusterer.addMarker(marker);
    }
</script>
</html>