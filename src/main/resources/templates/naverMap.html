<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>간단한 지도 표시하기</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
    <script type="text/javascript" src="https://oapi.map.naver.com/openapi/v3/maps.js?ncpClientId=nbou0njxso"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
</head>
<body>
    <div id="map" style="width:400px;height:400px;"></div>
</body>
<script>
    // 사용자의 position을 가져오고 비동기방식으로 서버에 전달
    window.onload = function() {
        // 지리적 위치가 지원되는지 확인
        if (navigator.geolocation) {
            // 지원되는 경우 getCurrentPosition() 메서드를 실행, 메서드가 실행되면 매개변수(getMap)에 지정된 함수 실행.
            navigator.geolocation.getCurrentPosition(getMap);
        }
        // 지원되지 않는 경우 사용자에게 메시지 표시
        else {
            // 모바일에선 어떻게 해줄지 고민해봐야함(모달?)
            alert("위치정보를 허용해주세요!");
        }
    }

    // getMap() 함수는 위도와 경도를 서버로 전달한다.
    function getMap(position) {
        var latitude = position.coords.latitude; // 위도
        var longitude = position.coords.longitude; // 경도
        // console.log(latitude);//37.5061331
        // console.log(longitude);//127.0283242

        var map = new naver.maps.Map('map', {
            // center: new naver.maps.LatLng(37.5061289, 127.028304),
            center: new naver.maps.LatLng(latitude, longitude),
            // 지도 초기 줌 레벨
            zoom: 16, // 100m
            // 지도 최소 줌 레벨
            minZoom: 10,
            // 줌 컨트롤 표시 여부
            zoomControl: true,
            // 지도 유형 컨트롤 표시 여부
            mapTypeControl: true,
            // 줌 컨트롤의 옵션
            zoomControlOptions: {
                // 줌 컨트롤의 위치를 우측 상단으로 배치함
                position: naver.maps.Position.TOP_RIGHT,
            },
            // 지도 데이터 저작권 컨트롤 표시 여부
            mapDataControl: false,
        });

        var marker = new naver.maps.Marker({
            // position: new naver.maps.LatLng(37.5061289, 127.028304),
            position: new naver.maps.LatLng(latitude, longitude),
            map: map
        });

        // var url="geocode";
        // var params="query=";
        // var params="coordinate=" + longitude + "," + latitude;

        $.ajax({
            type:"GET",
            url:"geocode",
            data: {
                query:"고기",
                location: latitude + "," + longitude
            },
            success:function(args){
                // $("#result").html(args);
                console.info(args);
            },
            // beforeSend:showRequest,
            error:function(e){
                alert(e.responseText);
            }
        });

        window.navermap_authFailure = function () {
            // 인증 실패 시 처리 코드 작성
            alert("인증 실패");
        }
    }
</script>
</html>